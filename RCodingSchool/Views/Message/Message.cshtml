@model  RCodingSchool.Mapping.ModelsVM.UserVM

@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <title>SignalR Simple Chat</title>
    <link href="~/Content/styles/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
.snippet{
    height: 500px;
    border: 1px solid #C1C1C1;
    overflow: auto;
}
    </style>
</head>
<body>
    <div class="container bootstrap ">
        <div class="row">
            <div class="col-md-3 bg-white  bg-white ">
                <div class="panel panel-default">
                    <div class="panel-heading">Повідомлення</div>
                    <div class="list-group">
                        <a href="#" class="list-group-item">Загальна бесіда <span class="badge">22</span></a>
                        <a href="#" class="list-group-item">507м <span class="badge">24</span></a>
                        <a href="#" class="list-group-item">Ігор Панчук <span class="badge">17</span></a>
                        <a href="#" class="list-group-item">Степан Миронюк <span class="badge">1</span></a>
                    </div>
                </div>
            </div>
            <div class="col-md-8 bg-white col-xs-12 bg-white ">
                <div class="chat-message snippet">
                    <div class="media " id="discussion">
                    </div>
                <div class="chat-box bg-white">
                    <!-- /input-group -->
                </div>
                    </div>
                <div class="input-group">
                    <input  type="text" id="message" class="form-control border no-shadow no-rounded" placeholder="Напишіть повідомлення">
                    <span class="input-group-btn">
                        <button id="sendmessage" class="btn btn-success no-rounded" type="button">Відправити</button>
                    </span>
                </div>
            </div>
            <div class="col-md-1 bg-white  bg-white "></div>
        </div>
    </div>

    <footer>
        <p>FMI &copy; 2017</p>
    </footer>

    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="~/Scripts/jquery-2.1.3.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        $(function () {
            // Declare a proxy to reference the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call to broadcast messages.
            chat.client.broadcastMessage = function (name, message, stringTime) {
                // Html encode display name and message.
                var encodedName = $('<div />').text(name).html();
                var encodedMsg = $('<div />').text(message).html();
                var now = new Date();
                var encodeNow = $('<div />').text(now).html();
                // Add the message to the page.
                $('#discussion').append('  <div class="media">' +
                         '<div class="media-left">' +
                             '<img src="../../Content/images/default_user.png" class="media-object" style="width:40px">' +
                         '</div>' +
                         '<div class="media-body">'+
                             '<h4 class="media-heading">' + encodedName + '<small> ' + stringTime + '</small></h4>' +
                             '<p>' + encodedMsg +'</p>'+
                         '</div>'+
                     '</div>'+
                 '</div><hr>');
            };
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#sendmessage').click(function () {
                    // Call the Send method on the hub.
                    var currentUserMail = '@Model.Email';
                    chat.server.send( $('#message').val(),currentUserMail);
                    // Clear text box and reset focus for next comment.
                    $('#message').val('').focus();
                });
            });
        });
    </script>
</body>
</html>